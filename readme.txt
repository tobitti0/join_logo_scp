//
// CM自動カット位置情報作成 join_logo_scp   by Yobi
//                          ver3.0対応
//

■ 概要

事前に別ソフトで検出した
・ロゴ表示区間
・無音＆シーンチェンジ
の情報を基にして、CMカット情報(Trim)を記載したAVSファイルを作成します。


■事前準備

・透過ロゴ表示区間検出 logoframe
・無音＆シーンチェンジ検索 chapter_exe（改造版 by Yobi を推奨）

を実行して、ロゴ表示区間と無音＆シーンチェンジ位置を
出力してください。
chapter_exeはオリジナルでも一応可能と思いますが、改造版 by Yobiを
使った方が明確に違いがわかるレベルで精度が上がります。

これに加え、カット処理方法を記載した実行内容スクリプトを使います。
（例として、添付ファイルの「JL_標準.txt」。３０分枠アニメのCMカットで
  チューニングしてありますが汎用的に使えると思います。）

※ロゴ結果なしでも精度は多少落ちますが動作可能にしました（ver2.1追加）。


■使い方

batファイル等で下記コマンドを実行。

join_logo_scp -inlogo ファイル名 -inscp ファイル名 -incmd ファイル名 -o ファイル名 その他オプション

（オプションの説明）

  オプションは左側から順番にアクセスして同じ設定は上書きされます。(ver3.0追加)
  そのため同じ項目設定があったら後側記載が有効になります。

  -inlogo ファイル名
    logoframeの"-oa"オプションで出力したファイル名を指定します。
    指定しない場合、ロゴ期間がない場合は全フレームがロゴ表示とみなします。

  -inscp ファイル名
    chapter_exeの"-o"オプションで出力したファイル名を指定します。[必須]

  -incmd ファイル名
    カット処理方法を記載した実行内容スクリプトを指定します。[必須]
    JL_標準.txt（このファイルと一緒に添付）が例です。

  -o ファイル名
    出力するCMカット情報のAVSファイル名です。[必須]

  -CutMrgIn 数値
    シーンチェンジからロゴ表示開始までのフレーム数を指定します。
    通常ロゴ別の固定値です。指定した方が精度が上がります。

  -CutMrgOut 数値
    ロゴ表示終了からシーンチェンジまでのフレーム数を指定します。
    通常ロゴ別の固定値です。指定した方が精度が上がります。

  -CutMrgWI 数値
    1を指定した場合、ロゴ表示開始位置にシーンチェンジがあった場合には
    設定値=0としてCutMrgInの値を使いません。(ver3.0追加)
    2を指定した場合、CutMrgInが小さい時のみ1を指定した動作をします。

  -CutMrgWO 数値
    1を指定した場合、ロゴ表示終了位置にシーンチェンジがあった場合には
    設定値=0としてCuMrgtOutの値を使いません。(ver3.0追加)
    2を指定した場合、CutMrgOutが小さい時のみ1を指定した動作をします。

  -flags フラグ名,フラグ名,フラグ名
    実行内容スクリプトで分岐処理を行う場合、分岐用フラグ名を指定します。
    ","で区切ることで複数のフラグ名を指定可能です。
    フラグ名:値 とすることでフラグ名に値を設定できます。(ver3.0追加)

 （例）-flags fa,fb:0,fc:2
     変数として fa=1,fb=0,fc=2 を設定します。fbはフラグなし扱いになります。

  -set 変数名 設定値
    実行内容スクリプトで使用する変数の値を設定できます。
    このオプションは繰り返し指定可能です。

  -lastcut 数値
    最終フレームから指定したフレーム数の画像は使用しません。
    最後は画像が乱れていて使いたくない場合に指定します。

  -oscp ファイル名
    解析用ファイルを出力します。番組構成把握の参考になります。
    CMが基本15秒単位であることを前提に解析情報（下記）を出力します。
      単位フレーム開始位置
      単位フレーム終了位置
      単位フレーム期間（秒数）
      単位フレーム期間秒数からの誤差（フレーム数）
      単位フレーム期間内のロゴ表示期間（秒数）
      単位フレームとして推測した構成（AutoCutコマンド使用時のみ表示）

  -F ファイル名
    オプションを別ファイルから読むことができます。(ver3.0追加)
    ファイル内にオプションそのまま記載していきますが、空白位置で改行可能です。
    #から始まる行はコメント扱いで読み込みません。

 ※-CutMrgIn,-CutMrgOutは指定がない場合に自動検出する処理が入っています。
   （指定した方が確実ですが、完全自動の精度を上げるため追加）


■ 最後に

CM自動カットの技術的可能性を調査する研究目的で作ったフリーソフトウェアです。
自環境での最適化検討を行っているバージョンです。
転載・改変は連絡不要です（各自の責任でお願いします）。
